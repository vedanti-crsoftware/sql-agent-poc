{
    "sample_query":"SELECT DISTINCT ca.cnsmr_accnt_id  from cnsmr_accnt ca INNER JOIN cnsmr_accnt_ownrs cao ON cao.cnsmr_accnt_id=ca.cnsmr_accnt_id and cao.cnsmr_accnt_ownrshp_sft_dlt_flg = 'N'  INNER JOIN cnsmr c ON c.cnsmr_id = cao.cnsmr_id INNER JOIN wrkgrp w on c.wrkgrp_id=w.wrkgrp_id  INNER JOIN dprtmnt d ON d.dprtmnt_id = w.wrkgrp_dprtmnt_id left join (SELECT trans.cnsmr_accnt_id, capj.pymnt_rvrsl_typ_cd, capj.cnsmr_accnt_pymnt_amnt, trans.cnsmr_accnt_trnsctn_pst_dt  FROM cnsmr_accnt_trnsctn trans  INNER JOIN cnsmr_accnt cac on trans.cnsmr_accnt_id = cac.cnsmr_accnt_id  INNER JOIN cnsmr prmry_cns on cac.cnsmr_id = prmry_cns.cnsmr_id  LEFT JOIN cnsmr_accnt_pymnt_jrnl capj on trans.cnsmr_accnt_pymnt_jrnl_id = capj.cnsmr_accnt_pymnt_jrnl_id  LEFT JOIN cnsmr_pymnt_jrnl cpj ON capj.cnsmr_pymnt_jrnl_id = cpj.cnsmr_pymnt_jrnl_id  LEFT JOIN cnsmr cpj_cns on cpj.cnsmr_id = cpj_cns.cnsmr_id    WHERE trans.CNSMR_ACCNT_TRNSCTN_ID IN (select trn.cnsmr_accnt_trnsctn_id  from cnsmr_accnt_trnsctn trn  inner join (select cnsmr_accnt_id, max(cnsmr_accnt_trnsctn_pst_dt) cnsmr_accnt_trnsctn_pst_dt  from cnsmr_accnt_trnsctn  group by cnsmr_accnt_id) trn1  on trn1.cnsmr_accnt_id = trn.cnsmr_accnt_id  and trn1.cnsmr_accnt_trnsctn_pst_dt = trn.cnsmr_accnt_trnsctn_pst_dt)) trans on trans.cnsmr_accnt_id = ca.cnsmr_accnt_id LEFT OUTER   JOIN (select catg.cnsmr_accnt_id as cnsmr_accnt_id from cnsmr_accnt_tag catg inner join tag catt on catt.tag_id=catg.tag_id  and catt.tag_shrt_nm in ('SIF','SIF1099','SIFGT600','SIFLT600','PIF','PIFFRGV','DCSDPIF','DCSDSIF','LGLPIF','LGLSIF') where catg.cnsmr_accnt_sft_delete_flg = 'N'  order by catg.cnsmr_accnt_id) TB_5 on ca.cnsmr_accnt_id = TB_5.cnsmr_accnt_id WHERE d.dprtmnt_shrt_nm = 'CNSRCVRY' and TB_5.cnsmr_accnt_id is null and ((trans.cnsmr_accnt_trnsctn_pst_dt >= (SELECT DBO.fn_relative_date(getDate(),-1,NULL)) and trans.cnsmr_accnt_pymnt_amnt > 0)  OR (cast(ca.cnsmr_accnt_plcmnt_date as date) = (cast(DBO.getdate() as date))))",
    "sample_query1":"SELECT pa.pymnt_arngmnt_id, ca.cnsmr_accnt_id, ca.cnsmr_accnt_nmbr, c.cnsmr_frst_nm, c.cnsmr_lst_nm, pa.pymnt_arngmnt_strt_dt, pa.pymnt_arngmnt_nd_dt, pa.pymnt_arngmnt_frqncy_cd, pa.pymnt_arngmnt_amnt, COUNT(pm.pymnt_miss_id) AS missed_payments, DATEDIFF(day, MAX(cat.cnsmr_accnt_trnsctn_pst_dt), GETDATE()) AS days_since_last_payment FROM pymnt_arngmnt pa INNER JOIN cnsmr_accnt ca ON pa.cnsmr_accnt_id = ca.cnsmr_accnt_id INNER JOIN cnsmr_accnt_ownrs cao ON cao.cnsmr_accnt_id = ca.cnsmr_accnt_id AND cao.cnsmr_accnt_ownrshp_sft_dlt_flg = 'N' INNER JOIN cnsmr c ON c.cnsmr_id = cao.cnsmr_id LEFT JOIN pymnt_miss pm ON pm.pymnt_arngmnt_id = pa.pymnt_arngmnt_id AND pm.pymnt_miss_rsn_cd != 'EXCUSED' LEFT JOIN cnsmr_accnt_trnsctn cat ON cat.cnsmr_accnt_id = ca.cnsmr_accnt_id AND cat.trnsctn_typ_cd = 'PAYMENT' WHERE pa.pymnt_arngmnt_stts_cd = 'ACTIVE' AND pa.pymnt_arngmnt_nd_dt > GETDATE() GROUP BY pa.pymnt_arngmnt_id, ca.cnsmr_accnt_id, ca.cnsmr_accnt_nmbr, c.cnsmr_frst_nm, c.cnsmr_lst_nm, pa.pymnt_arngmnt_strt_dt, pa.pymnt_arngmnt_nd_dt, pa.pymnt_arngmnt_frqncy_cd, pa.pymnt_arngmnt_amnt HAVING COUNT(pm.pymnt_miss_id) > 0 OR DATEDIFF(day, MAX(cat.cnsmr_accnt_trnsctn_pst_dt), GETDATE()) > CASE pa.pymnt_arngmnt_frqncy_cd WHEN 'WEEKLY' THEN 10 WHEN 'BIWEEKLY' THEN 18 WHEN 'MONTHLY' THEN 35 ELSE 30 END ORDER BY days_since_last_payment DESC;",
    "sample_query2":"SELECT e.emplye_id, e.emplye_frst_nm + ' ' + e.emplye_lst_nm AS collector_name, w.wrkgrp_nm, d.dprtmnt_shrt_nm, COUNT(DISTINCT ca.cnsmr_accnt_id) AS total_accounts, SUM(ca.cnsmr_accnt_crnt_blnc) AS total_balance, SUM(ca.cnsmr_accnt_orgnl_blnc) AS total_original_balance, SUM(pmt.payment_amount_90_days) AS total_payments_90days, SUM(pmt.payment_amount_90_days)/NULLIF(SUM(ca.cnsmr_accnt_orgnl_blnc),0) * 100 AS recovery_rate, COUNT(DISTINCT CASE WHEN ca.cnsmr_accnt_stts_cd = 'PAID' AND ca.cnsmr_accnt_clsd_dt >= DATEADD(day, -30, GETDATE()) THEN ca.cnsmr_accnt_id END) AS accounts_paid_last_30days FROM cnsmr_accnt ca INNER JOIN cnsmr_accnt_ownrs cao ON cao.cnsmr_accnt_id = ca.cnsmr_accnt_id AND cao.cnsmr_accnt_ownrshp_sft_dlt_flg = 'N' INNER JOIN cnsmr c ON c.cnsmr_id = cao.cnsmr_id INNER JOIN emplye e ON e.emplye_id = ca.assgnd_emplye_id INNER JOIN wrkgrp w ON e.wrkgrp_id = w.wrkgrp_id INNER JOIN dprtmnt d ON d.dprtmnt_id = w.wrkgrp_dprtmnt_id LEFT JOIN (SELECT cat.cnsmr_accnt_id, SUM(CASE WHEN cat.cnsmr_accnt_trnsctn_pst_dt >= DATEADD(day, -90, GETDATE()) THEN capj.cnsmr_accnt_pymnt_amnt ELSE 0 END) AS payment_amount_90_days FROM cnsmr_accnt_trnsctn cat INNER JOIN cnsmr_accnt_pymnt_jrnl capj ON cat.cnsmr_accnt_pymnt_jrnl_id = capj.cnsmr_accnt_pymnt_jrnl_id WHERE cat.trnsctn_typ_cd = 'PAYMENT' AND capj.pymnt_rvrsl_typ_cd IS NULL GROUP BY cat.cnsmr_accnt_id) pmt ON pmt.cnsmr_accnt_id = ca.cnsmr_accnt_id WHERE ca.cnsmr_accnt_plcmnt_date >= DATEADD(month, -12, GETDATE()) AND d.dprtmnt_shrt_nm IN ('CNSRCVRY', 'LGLCOL') GROUP BY e.emplye_id, e.emplye_frst_nm + ' ' + e.emplye_lst_nm, w.wrkgrp_nm, d.dprtmnt_shrt_nm ORDER BY recovery_rate DESC;",
    "sample_query3":"SELECT ca.cnsmr_accnt_id, ca.cnsmr_accnt_nmbr, c.cnsmr_frst_nm, c.cnsmr_lst_nm, ca.cnsmr_accnt_crnt_blnc, ca.cnsmr_accnt_orgnl_blnc, ca.cnsmr_accnt_plcmnt_date, MAX(cnt.cntct_dt) AS last_contact_date, DATEDIFF(day, MAX(cnt.cntct_dt), GETDATE()) AS days_since_last_contact, COUNT(DISTINCT cnt.cntct_id) AS total_contacts, COUNT(DISTINCT ltr.lttr_id) AS total_letters_sent, MAX(ltr.lttr_snt_dt) AS last_letter_date, STUFF((SELECT ', ' + tag.tag_shrt_nm FROM cnsmr_accnt_tag cat JOIN tag ON tag.tag_id = cat.tag_id WHERE cat.cnsmr_accnt_id = ca.cnsmr_accnt_id AND cat.cnsmr_accnt_sft_delete_flg = 'N' FOR XML PATH('')), 1, 2, '') AS account_tags FROM cnsmr_accnt ca INNER JOIN cnsmr_accnt_ownrs cao ON cao.cnsmr_accnt_id = ca.cnsmr_accnt_id AND cao.cnsmr_accnt_ownrshp_sft_dlt_flg = 'N' INNER JOIN cnsmr c ON c.cnsmr_id = cao.cnsmr_id INNER JOIN wrkgrp w ON c.wrkgrp_id = w.wrkgrp_id INNER JOIN dprtmnt d ON d.dprtmnt_id = w.wrkgrp_dprtmnt_id LEFT JOIN cntct cnt ON cnt.cnsmr_id = c.cnsmr_id AND cnt.cntct_stts_cd = 'COMPLETED' LEFT JOIN lttr ltr ON ltr.cnsmr_accnt_id = ca.cnsmr_accnt_id AND ltr.lttr_stts_cd = 'SENT' LEFT JOIN (SELECT cat.cnsmr_accnt_id FROM cnsmr_accnt_tag cat INNER JOIN tag t ON t.tag_id = cat.tag_id WHERE t.tag_shrt_nm IN ('LEGAL', 'LGLRVW', 'LGLAPPRV', 'LGLREJ') AND cat.cnsmr_accnt_sft_delete_flg = 'N') legal_tags ON legal_tags.cnsmr_accnt_id = ca.cnsmr_accnt_id WHERE d.dprtmnt_shrt_nm = 'CNSRCVRY' AND ca.cnsmr_accnt_stts_cd = 'ACTIVE' AND ca.cnsmr_accnt_crnt_blnc > 1000 AND DATEDIFF(day, ca.cnsmr_accnt_plcmnt_date, GETDATE()) > 90 AND legal_tags.cnsmr_accnt_id IS NULL AND NOT EXISTS (SELECT 1 FROM pymnt_arngmnt pa WHERE pa.cnsmr_accnt_id = ca.cnsmr_accnt_id AND pa.pymnt_arngmnt_stts_cd = 'ACTIVE') GROUP BY ca.cnsmr_accnt_id, ca.cnsmr_accnt_nmbr, c.cnsmr_frst_nm, c.cnsmr_lst_nm, ca.cnsmr_accnt_crnt_blnc, ca.cnsmr_accnt_orgnl_blnc, ca.cnsmr_accnt_plcmnt_date HAVING COUNT(DISTINCT cnt.cntct_id) >= 5 AND MAX(cnt.cntct_dt) < DATEADD(day, -30, GETDATE()) AND MAX(ltr.lttr_snt_dt) < DATEADD(day, -21, GETDATE()) ORDER BY ca.cnsmr_accnt_crnt_blnc DESC;",
    "sample_query4":"WITH SettlementPayments AS (SELECT ca.cnsmr_accnt_id, ca.cnsmr_accnt_nmbr, ca.cnsmr_accnt_orgnl_blnc, st.stlmnt_id, st.stlmnt_agrmnt_dt, st.stlmnt_amnt, st.stlmnt_stts_cd, st.stlmnt_amnt/NULLIF(ca.cnsmr_accnt_orgnl_blnc, 0) * 100 AS settlement_percentage, SUM(capj.cnsmr_accnt_pymnt_amnt) AS total_paid, COUNT(capj.cnsmr_accnt_pymnt_jrnl_id) AS payment_count, MAX(cat.cnsmr_accnt_trnsctn_pst_dt) AS last_payment_date FROM cnsmr_accnt ca INNER JOIN stlmnt st ON st.cnsmr_accnt_id = ca.cnsmr_accnt_id LEFT JOIN cnsmr_accnt_trnsctn cat ON cat.cnsmr_accnt_id = ca.cnsmr_accnt_id AND cat.trnsctn_typ_cd = 'PAYMENT' AND cat.cnsmr_accnt_trnsctn_pst_dt >= st.stlmnt_agrmnt_dt LEFT JOIN cnsmr_accnt_pymnt_jrnl capj ON cat.cnsmr_accnt_pymnt_jrnl_id = capj.cnsmr_accnt_pymnt_jrnl_id AND capj.pymnt_rvrsl_typ_cd IS NULL WHERE ca.cnsmr_accnt_orgnl_blnc > 10000 AND st.stlmnt_agrmnt_dt >= DATEADD(month, -12, GETDATE()) GROUP BY ca.cnsmr_accnt_id, ca.cnsmr_accnt_nmbr, ca.cnsmr_accnt_orgnl_blnc, st.stlmnt_id, st.stlmnt_agrmnt_dt, st.stlmnt_amnt, st.stlmnt_stts_cd) SELECT sp.cnsmr_accnt_id, sp.cnsmr_accnt_nmbr, c.cnsmr_frst_nm + ' ' + c.cnsmr_lst_nm AS consumer_name, e.emplye_frst_nm + ' ' + e.emplye_lst_nm AS negotiator_name, d.dprtmnt_shrt_nm, sp.cnsmr_accnt_orgnl_blnc AS original_balance, sp.stlmnt_amnt AS settlement_amount, sp.settlement_percentage, sp.total_paid, (sp.total_paid/NULLIF(sp.stlmnt_amnt, 0)) * 100 AS percent_paid, sp.stlmnt_agrmnt_dt, sp.last_payment_date, sp.stlmnt_stts_cd, CASE WHEN sp.total_paid >= sp.stlmnt_amnt THEN 'COMPLETED' WHEN sp.stlmnt_stts_cd = 'CANCELLED' THEN 'FAILED' WHEN sp.last_payment_date IS NULL OR DATEDIFF(day, sp.last_payment_date, GETDATE()) > 30 THEN 'AT RISK' ELSE 'IN PROGRESS' END AS settlement_status FROM SettlementPayments sp INNER JOIN cnsmr_accnt ca ON ca.cnsmr_accnt_id = sp.cnsmr_accnt_id INNER JOIN cnsmr_accnt_ownrs cao ON cao.cnsmr_accnt_id = ca.cnsmr_accnt_id AND cao.cnsmr_accnt_ownrshp_sft_dlt_flg = 'N' INNER JOIN cnsmr c ON c.cnsmr_id = cao.cnsmr_id INNER JOIN emplye e ON e.emplye_id = ca.assgnd_emplye_id INNER JOIN wrkgrp w ON e.wrkgrp_id = w.wrkgrp_id INNER JOIN dprtmnt d ON d.dprtmnt_id = w.wrkgrp_dprtmnt_id ORDER BY sp.settlement_percentage, sp.cnsmr_accnt_orgnl_blnc DESC;",
    "sample_query5":"SELECT ca.cnsmr_accnt_id, ca.cnsmr_accnt_nmbr, ca.cnsmr_accnt_orgnl_blnc, ca.cnsmr_accnt_crnt_blnc, ca.cnsmr_accnt_plcmnt_date, DATEDIFF(day, ca.cnsmr_accnt_plcmnt_date, GETDATE()) AS days_in_collections, c.cnsmr_frst_nm + ' ' + c.cnsmr_lst_nm AS consumer_name, c.cnsmr_phn_nmbr, c.cnsmr_email_addrss, e.emplye_frst_nm + ' ' + e.emplye_lst_nm AS collector_name, MAX(cnt.cntct_dt) AS last_contact_attempt, DATEDIFF(day, MAX(cnt.cntct_dt), GETDATE()) AS days_since_last_contact, MAX(CASE WHEN cnt.cntct_rslt_cd = 'RPC' THEN cnt.cntct_dt ELSE NULL END) AS last_right_party_contact, MAX(cat.cnsmr_accnt_trnsctn_pst_dt) AS last_transaction_date, STUFF((SELECT ', ' + scr.scre_valu + ' (' + CONVERT(VARCHAR(10), scr.scre_dt, 101) + ')' FROM cnsmr_scrng scr WHERE scr.cnsmr_id = c.cnsmr_id AND scr.scre_typ_cd = 'COLLECTIONS' ORDER BY scr.scre_dt DESC FOR XML PATH(''), TYPE).value('.', 'NVARCHAR(MAX)'), 1, 2, '') AS collection_scores FROM cnsmr_accnt ca INNER JOIN cnsmr_accnt_ownrs cao ON cao.cnsmr_accnt_id = ca.cnsmr_accnt_id AND cao.cnsmr_accnt_ownrshp_sft_dlt_flg = 'N' INNER JOIN cnsmr c ON c.cnsmr_id = cao.cnsmr_id INNER JOIN emplye e ON e.emplye_id = ca.assgnd_emplye_id INNER JOIN wrkgrp w ON e.wrkgrp_id = w.wrkgrp_id INNER JOIN dprtmnt d ON d.dprtmnt_id = w.wrkgrp_dprtmnt_id LEFT JOIN cntct cnt ON cnt.cnsmr_id = c.cnsmr_id LEFT JOIN cnsmr_accnt_trnsctn cat ON cat.cnsmr_accnt_id = ca.cnsmr_accnt_id WHERE d.dprtmnt_shrt_nm IN ('CNSRCVRY', 'EARLYOUT') AND ca.cnsmr_accnt_stts_cd = 'ACTIVE' AND ca.cnsmr_accnt_crnt_blnc > 0 AND ca.cnsmr_accnt_plcmnt_date < DATEADD(day, -60, GETDATE()) AND NOT EXISTS (SELECT 1 FROM cnsmr_accnt_tag cat INNER JOIN tag t ON t.tag_id = cat.tag_id WHERE cat.cnsmr_accnt_id = ca.cnsmr_accnt_id AND cat.cnsmr_accnt_sft_delete_flg = 'N' AND t.tag_shrt_nm IN ('SKIP', 'BANKRUPTCY', 'DECEASED', 'DISPUTE', 'LEGAL')) GROUP BY ca.cnsmr_accnt_id, ca.cnsmr_accnt_nmbr, ca.cnsmr_accnt_orgnl_blnc, ca.cnsmr_accnt_crnt_blnc, ca.cnsmr_accnt_plcmnt_date, c.cnsmr_frst_nm + ' ' + c.cnsmr_lst_nm, c.cnsmr_phn_nmbr, c.cnsmr_email_addrss, e.emplye_frst_nm + ' ' + e.emplye_lst_nm, c.cnsmr_id HAVING (MAX(cnt.cntct_dt) IS NULL OR DATEDIFF(day, MAX(cnt.cntct_dt), GETDATE()) > 30) AND (MAX(cat.cnsmr_accnt_trnsctn_pst_dt) IS NULL OR DATEDIFF(day, MAX(cat.cnsmr_accnt_trnsctn_pst_dt), GETDATE()) > 45) ORDER BY days_since_last_contact DESC, ca.cnsmr_accnt_crnt_blnc DESC;",
    "sample_query6":"SELECT ca.cnsmr_accnt_id, ca.cnsmr_accnt_nmbr, c.cnsmr_frst_nm + ' ' + c.cnsmr_lst_nm AS consumer_name, ca.cnsmr_accnt_crnt_blnc, DATEDIFF(day, ca.cnsmr_accnt_plcmnt_date, GETDATE()) AS days_since_placement, ROUND(SUM(CASE WHEN cat.cnsmr_accnt_trnsctn_pst_dt >= DATEADD(month, -3, GETDATE()) THEN capj.cnsmr_accnt_pymnt_amnt ELSE 0 END), 2) AS payments_last_3_months, (SELECT TOP 1 pa.pymnt_arngmnt_amnt FROM pymnt_arngmnt pa WHERE pa.cnsmr_accnt_id = ca.cnsmr_accnt_id AND pa.pymnt_arngmnt_stts_cd = 'ACTIVE' ORDER BY pa.pymnt_arngmnt_strt_dt DESC) AS current_arrangement_amount, COUNT(DISTINCT CASE WHEN cnt.cntct_dt >= DATEADD(month, -1, GETDATE()) THEN cnt.cntct_id END) AS contacts_last_month, (SELECT COUNT(*) FROM pymnt_miss pm INNER JOIN pymnt_arngmnt pa ON pm.pymnt_arngmnt_id = pa.pymnt_arngmnt_id WHERE pa.cnsmr_accnt_id = ca.cnsmr_accnt_id AND pm.pymnt_miss_dt >= DATEADD(month, -6, GETDATE())) AS missed_payments_last_6_months FROM cnsmr_accnt ca INNER JOIN cnsmr_accnt_ownrs cao ON cao.cnsmr_accnt_id = ca.cnsmr_accnt_id AND cao.cnsmr_accnt_ownrshp_sft_dlt_flg = 'N' INNER JOIN cnsmr c ON c.cnsmr_id = cao.cnsmr_id LEFT JOIN cnsmr_accnt_trnsctn cat ON cat.cnsmr_accnt_id = ca.cnsmr_accnt_id LEFT JOIN cnsmr_accnt_pymnt_jrnl capj ON cat.cnsmr_accnt_pymnt_jrnl_id = capj.cnsmr_accnt_pymnt_jrnl_id AND capj.pymnt_rvrsl_typ_cd IS NULL LEFT JOIN cntct cnt ON cnt.cnsmr_id = c.cnsmr_id AND cnt.cntct_stts_cd = 'COMPLETED' WHERE ca.cnsmr_accnt_stts_cd = 'ACTIVE' AND ca.cnsmr_accnt_crnt_blnc > 0 GROUP BY ca.cnsmr_accnt_id, ca.cnsmr_accnt_nmbr, c.cnsmr_frst_nm + ' ' + c.cnsmr_lst_nm, ca.cnsmr_accnt_crnt_blnc, ca.cnsmr_accnt_plcmnt_date HAVING (SUM(CASE WHEN cat.cnsmr_accnt_trnsctn_pst_dt >= DATEADD(day, -60, GETDATE()) THEN capj.cnsmr_accnt_pymnt_amnt ELSE 0 END) > 0 OR EXISTS (SELECT 1 FROM pymnt_arngmnt pa WHERE pa.cnsmr_accnt_id = ca.cnsmr_accnt_id AND pa.pymnt_arngmnt_stts_cd = 'ACTIVE')) ORDER BY ca.cnsmr_accnt_crnt_blnc DESC;",
    "sample_query7":"WITH AccountAging AS (SELECT ca.cnsmr_accnt_id, ca.assgnd_emplye_id, DATEDIFF(day, ca.cnsmr_accnt_plcmnt_date, GETDATE()) AS days_in_collections, CASE WHEN DATEDIFF(day, ca.cnsmr_accnt_plcmnt_date, GETDATE()) <= 30 THEN '0-30' WHEN DATEDIFF(day, ca.cnsmr_accnt_plcmnt_date, GETDATE()) BETWEEN 31 AND 60 THEN '31-60' WHEN DATEDIFF(day, ca.cnsmr_accnt_plcmnt_date, GETDATE()) BETWEEN 61 AND 90 THEN '61-90' WHEN DATEDIFF(day, ca.cnsmr_accnt_plcmnt_date, GETDATE()) BETWEEN 91 AND 180 THEN '91-180' WHEN DATEDIFF(day, ca.cnsmr_accnt_plcmnt_date, GETDATE()) BETWEEN 181 AND 365 THEN '181-365' ELSE '365+' END AS aging_bucket, ca.cnsmr_accnt_crnt_blnc, ca.cnsmr_accnt_orgnl_blnc, (SELECT SUM(capj2.cnsmr_accnt_pymnt_amnt) FROM cnsmr_accnt_trnsctn cat2 INNER JOIN cnsmr_accnt_pymnt_jrnl capj2 ON cat2.cnsmr_accnt_pymnt_jrnl_id = capj2.cnsmr_accnt_pymnt_jrnl_id WHERE cat2.cnsmr_accnt_id = ca.cnsmr_accnt_id AND cat2.cnsmr_accnt_trnsctn_pst_dt >= DATEADD(day, -90, GETDATE()) AND capj2.pymnt_rvrsl_typ_cd IS NULL) AS payments_last_90days FROM cnsmr_accnt ca WHERE ca.cnsmr_accnt_stts_cd = 'ACTIVE' AND ca.cnsmr_accnt_crnt_blnc > 0) SELECT e.emplye_id, e.emplye_frst_nm + ' ' + e.emplye_lst_nm AS collector_name, w.wrkgrp_nm, d.dprtmnt_shrt_nm, ag.aging_bucket, COUNT(DISTINCT ag.cnsmr_accnt_id) AS account_count, SUM(ag.cnsmr_accnt_crnt_blnc) AS total_current_balance, SUM(ag.cnsmr_accnt_orgnl_blnc) AS total_original_balance, SUM(ISNULL(ag.payments_last_90days, 0)) AS total_payments_90days, CASE WHEN SUM(ag.cnsmr_accnt_orgnl_blnc) > 0 THEN ROUND(SUM(ISNULL(ag.payments_last_90days, 0)) / SUM(ag.cnsmr_accnt_orgnl_blnc) * 100, 2) ELSE 0 END AS recovery_rate_pct FROM AccountAging ag INNER JOIN emplye e ON e.emplye_id = ag.assgnd_emplye_id INNER JOIN wrkgrp w ON e.wrkgrp_id = w.wrkgrp_id INNER JOIN dprtmnt d ON d.dprtmnt_id = w.wrkgrp_dprtmnt_id WHERE d.dprtmnt_shrt_nm IN ('CNSRCVRY', 'LGLCOL', 'EARLYOUT') GROUP BY e.emplye_id, e.emplye_frst_nm + ' ' + e.emplye_lst_nm, w.wrkgrp_nm, d.dprtmnt_shrt_nm, ag.aging_bucket ORDER BY d.dprtmnt_shrt_nm, w.wrkgrp_nm, e.emplye_lst_nm, ag.aging_bucket;",
    "sample_query8":"SELECT s.stlmnt_id, ca.cnsmr_accnt_id, ca.cnsmr_accnt_nmbr, c.cnsmr_frst_nm + ' ' + c.cnsmr_lst_nm AS consumer_name, ca.cnsmr_accnt_crnt_blnc, ca.cnsmr_accnt_orgnl_blnc, s.stlmnt_agrmnt_dt, s.stlmnt_amnt, s.stlmnt_amnt / NULLIF(ca.cnsmr_accnt_orgnl_blnc, 0) * 100 AS settlement_percentage, s.stlmnt_stts_cd, s.stlmnt_aprv_dt, e.emplye_frst_nm + ' ' + e.emplye_lst_nm AS approved_by, (SELECT COUNT(*) FROM stlmnt_pln_pymnt spp WHERE spp.stlmnt_id = s.stlmnt_id) AS total_planned_payments, (SELECT COUNT(*) FROM stlmnt_pln_pymnt spp WHERE spp.stlmnt_id = s.stlmnt_id AND spp.stlmnt_pln_pymnt_due_dt < GETDATE()) AS planned_payments_due, (SELECT COUNT(*) FROM stlmnt_pln_pymnt spp INNER JOIN cnsmr_accnt_trnsctn cat ON spp.stlmnt_pln_pymnt_id = cat.stlmnt_pln_pymnt_id INNER JOIN cnsmr_accnt_pymnt_jrnl capj ON cat.cnsmr_accnt_pymnt_jrnl_id = capj.cnsmr_accnt_pymnt_jrnl_id WHERE spp.stlmnt_id = s.stlmnt_id AND capj.pymnt_rvrsl_typ_cd IS NULL) AS payments_made, SUM(CASE WHEN capj.pymnt_rvrsl_typ_cd IS NULL THEN capj.cnsmr_accnt_pymnt_amnt ELSE 0 END) AS total_amount_paid, (SELECT MAX(cat2.cnsmr_accnt_trnsctn_pst_dt) FROM cnsmr_accnt_trnsctn cat2 INNER JOIN cnsmr_accnt_pymnt_jrnl capj2 ON cat2.cnsmr_accnt_pymnt_jrnl_id = capj2.cnsmr_accnt_pymnt_jrnl_id WHERE cat2.cnsmr_accnt_id = ca.cnsmr_accnt_id AND cat2.cnsmr_accnt_trnsctn_pst_dt >= s.stlmnt_agrmnt_dt AND capj2.pymnt_rvrsl_typ_cd IS NULL) AS last_payment_date, DATEDIFF(day, (SELECT MAX(cat2.cnsmr_accnt_trnsctn_pst_dt) FROM cnsmr_accnt_trnsctn cat2 INNER JOIN cnsmr_accnt_pymnt_jrnl capj2 ON cat2.cnsmr_accnt_pymnt_jrnl_id = capj2.cnsmr_accnt_pymnt_jrnl_id WHERE cat2.cnsmr_accnt_id = ca.cnsmr_accnt_id AND cat2.cnsmr_accnt_trnsctn_pst_dt >= s.stlmnt_agrmnt_dt AND capj2.pymnt_rvrsl_typ_cd IS NULL), GETDATE()) AS days_since_last_payment, CASE WHEN s.stlmnt_stts_cd = 'FULFILLED' THEN 'COMPLETED' WHEN s.stlmnt_stts_cd = 'CANCELLED' THEN 'FAILED' WHEN (SELECT MAX(cat2.cnsmr_accnt_trnsctn_pst_dt) FROM cnsmr_accnt_trnsctn cat2 INNER JOIN cnsmr_accnt_pymnt_jrnl capj2 ON cat2.cnsmr_accnt_pymnt_jrnl_id = capj2.cnsmr_accnt_pymnt_jrnl_id WHERE cat2.cnsmr_accnt_id = ca.cnsmr_accnt_id AND cat2.cnsmr_accnt_trnsctn_pst_dt >= s.stlmnt_agrmnt_dt AND capj2.pymnt_rvrsl_typ_cd IS NULL) IS NULL OR DATEDIFF(day, (SELECT MAX(cat2.cnsmr_accnt_trnsctn_pst_dt) FROM cnsmr_accnt_trnsctn cat2 INNER JOIN cnsmr_accnt_pymnt_jrnl capj2 ON cat2.cnsmr_accnt_pymnt_jrnl_id = capj2.cnsmr_accnt_pymnt_jrnl_id WHERE cat2.cnsmr_accnt_id = ca.cnsmr_accnt_id AND cat2.cnsmr_accnt_trnsctn_pst_dt >= s.stlmnt_agrmnt_dt AND capj2.pymnt_rvrsl_typ_cd IS NULL), GETDATE()) > 30 THEN 'AT RISK' ELSE 'IN PROGRESS' END AS settlement_status FROM stlmnt s INNER JOIN cnsmr_accnt ca ON s.cnsmr_accnt_id = ca.cnsmr_accnt_id INNER JOIN cnsmr_accnt_ownrs cao ON cao.cnsmr_accnt_id = ca.cnsmr_accnt_id AND cao.cnsmr_accnt_ownrshp_sft_dlt_flg = 'N' INNER JOIN cnsmr c ON c.cnsmr_id = cao.cnsmr_id INNER JOIN emplye e ON e.emplye_id = s.stlmnt_aprv_emplye_id LEFT JOIN stlmnt_pln_pymnt spp ON spp.stlmnt_id = s.stlmnt_id LEFT JOIN cnsmr_accnt_trnsctn cat ON cat.stlmnt_pln_pymnt_id = spp.stlmnt_pln_pymnt_id LEFT JOIN cnsmr_accnt_pymnt_jrnl capj ON cat.cnsmr_accnt_pymnt_jrnl_id = capj.cnsmr_accnt_pymnt_jrnl_id WHERE s.stlmnt_agrmnt_dt >= DATEADD(month, -6, GETDATE()) GROUP BY s.stlmnt_id, ca.cnsmr_accnt_id, ca.cnsmr_accnt_nmbr, c.cnsmr_frst_nm + ' ' + c.cnsmr_lst_nm, ca.cnsmr_accnt_crnt_blnc, ca.cnsmr_accnt_orgnl_blnc, s.stlmnt_agrmnt_dt, s.stlmnt_amnt, s.stlmnt_stts_cd, s.stlmnt_aprv_dt, e.emplye_frst_nm + ' ' + e.emplye_lst_nm ORDER BY s.stlmnt_agrmnt_dt DESC;",
    "sample_query9":"SELECT d.dprtmnt_shrt_nm, w.wrkgrp_nm, e.emplye_frst_nm + ' ' + e.emplye_lst_nm AS collector_name, COUNT(DISTINCT ca.cnsmr_accnt_id) AS total_accounts, SUM(ca.cnsmr_accnt_crnt_blnc) AS total_balance, SUM(ca.cnsmr_accnt_orgnl_blnc) AS total_original_balance, SUM(CASE WHEN EXISTS (SELECT 1 FROM pymnt_arngmnt pa WHERE pa.cnsmr_accnt_id = ca.cnsmr_accnt_id AND pa.pymnt_arngmnt_stts_cd = 'ACTIVE') THEN ca.cnsmr_accnt_crnt_blnc ELSE 0 END) AS balance_on_arrangement, COUNT(DISTINCT CASE WHEN EXISTS (SELECT 1 FROM pymnt_arngmnt pa WHERE pa.cnsmr_accnt_id = ca.cnsmr_accnt_id AND pa.pymnt_arngmnt_stts_cd = 'ACTIVE') THEN ca.cnsmr_accnt_id END) AS accounts_on_arrangement, SUM(CASE WHEN EXISTS (SELECT 1 FROM stlmnt st WHERE st.cnsmr_accnt_id = ca.cnsmr_accnt_id AND st.stlmnt_stts_cd = 'ACTIVE') THEN ca.cnsmr_accnt_crnt_blnc ELSE 0 END) AS balance_in_settlement, COUNT(DISTINCT CASE WHEN EXISTS (SELECT 1 FROM stlmnt st WHERE st.cnsmr_accnt_id = ca.cnsmr_accnt_id AND st.stlmnt_stts_cd = 'ACTIVE') THEN ca.cnsmr_accnt_id END) AS accounts_in_settlement, SUM(CASE WHEN ca.cnsmr_accnt_plcmnt_date >= DATEADD(day, -30, GETDATE()) THEN ca.cnsmr_accnt_crnt_blnc ELSE 0 END) AS new_inventory_30days, COUNT(DISTINCT CASE WHEN ca.cnsmr_accnt_plcmnt_date >= DATEADD(day, -30, GETDATE()) THEN ca.cnsmr_accnt_id END) AS new_accounts_30days, (SELECT SUM(capj2.cnsmr_accnt_pymnt_amnt) FROM cnsmr_accnt_trnsctn cat2 INNER JOIN cnsmr_accnt_pymnt_jrnl capj2 ON cat2.cnsmr_accnt_pymnt_jrnl_id = capj2.cnsmr_accnt_pymnt_jrnl_id WHERE cat2.cnsmr_accnt_id IN (SELECT ca2.cnsmr_accnt_id FROM cnsmr_accnt ca2 WHERE ca2.assgnd_emplye_id = e.emplye_id) AND cat2.cnsmr_accnt_trnsctn_pst_dt >= DATEADD(day, -30, GETDATE()) AND capj2.pymnt_rvrsl_typ_cd IS NULL) AS payments_last_30days, COUNT(DISTINCT CASE WHEN ca.cnsmr_accnt_stts_cd = 'PAID' AND ca.cnsmr_accnt_clsd_dt >= DATEADD(day, -30, GETDATE()) THEN ca.cnsmr_accnt_id END) AS accounts_paid_last_30days FROM cnsmr_accnt ca INNER JOIN emplye e ON e.emplye_id = ca.assgnd_emplye_id INNER JOIN wrkgrp w ON e.wrkgrp_id = w.wrkgrp_id INNER JOIN dprtmnt d ON d.dprtmnt_id = w.wrkgrp_dprtmnt_id WHERE ca.cnsmr_accnt_stts_cd IN ('ACTIVE', 'PAID', 'SETTLED') AND (ca.cnsmr_accnt_stts_cd != 'PAID' OR ca.cnsmr_accnt_clsd_dt >= DATEADD(month, -3, GETDATE())) GROUP BY d.dprtmnt_shrt_nm, w.wrkgrp_nm, e.emplye_frst_nm + ' ' + e.emplye_lst_nm, e.emplye_id ORDER BY d.dprtmnt_shrt_nm, w.wrkgrp_nm, SUM(ca.cnsmr_accnt_crnt_blnc) DESC;",
    "sample_query10":"WITH ContactEffectiveness AS (SELECT c.cnsmr_id, cnt.cntct_dt, cnt.cntct_typ_cd, cnt.cntct_rslt_cd, ROW_NUMBER() OVER (PARTITION BY c.cnsmr_id, CAST(cnt.cntct_dt AS DATE) ORDER BY cnt.cntct_dt DESC) AS contact_rank, CASE WHEN cnt.cntct_rslt_cd = 'RPC' THEN 1 ELSE 0 END AS is_rpc, CASE WHEN EXISTS (SELECT 1 FROM cnsmr_accnt_trnsctn cat INNER JOIN cnsmr_accnt_ownrs cao ON cat.cnsmr_accnt_id = cao.cnsmr_accnt_id INNER JOIN cnsmr_accnt_pymnt_jrnl capj ON cat.cnsmr_accnt_pymnt_jrnl_id = capj.cnsmr_accnt_pymnt_jrnl_id WHERE cao.cnsmr_id = c.cnsmr_id AND cat.cnsmr_accnt_trnsctn_pst_dt BETWEEN cnt.cntct_dt AND DATEADD(day, 7, cnt.cntct_dt) AND capj.pymnt_rvrsl_typ_cd IS NULL) THEN 1 ELSE 0 END AS payment_within_7days, CASE WHEN EXISTS (SELECT 1 FROM pymnt_arngmnt pa INNER JOIN cnsmr_accnt ca ON pa.cnsmr_accnt_id = ca.cnsmr_accnt_id INNER JOIN cnsmr_accnt_ownrs cao ON ca.cnsmr_accnt_id = cao.cnsmr_accnt_id WHERE cao.cnsmr_id = c.cnsmr_id AND pa.pymnt_arngmnt_strt_dt BETWEEN cnt.cntct_dt AND DATEADD(day, 7, cnt.cntct_dt)) THEN 1 ELSE 0 END AS arrangement_within_7days FROM cnsmr c INNER JOIN cntct cnt ON cnt.cnsmr_id = c.cnsmr_id WHERE cnt.cntct_dt >= DATEADD(month, -3, GETDATE()) AND cnt.cntct_stts_cd = 'COMPLETED') SELECT e.emplye_id, e.emplye_frst_nm + ' ' + e.emplye_lst_nm AS collector_name, d.dprtmnt_shrt_nm, ce.cntct_typ_cd, COUNT(DISTINCT CASE WHEN ce.contact_rank = 1 THEN CAST(ce.cnsmr_id AS VARCHAR) + '_' + CAST(ce.cntct_dt AS VARCHAR) END) AS total_contacts, SUM(CASE WHEN ce.contact_rank = 1 THEN ce.is_rpc ELSE 0 END) AS total_rpcs, CASE WHEN COUNT(DISTINCT CASE WHEN ce.contact_rank = 1 THEN CAST(ce.cnsmr_id AS VARCHAR) + '_' + CAST(ce.cntct_dt AS VARCHAR) END) > 0 THEN CAST(SUM(CASE WHEN ce.contact_rank = 1 THEN ce.is_rpc ELSE 0 END) AS FLOAT) / COUNT(DISTINCT CASE WHEN ce.contact_rank = 1 THEN CAST(ce.cnsmr_id AS VARCHAR) + '_' + CAST(ce.cntct_dt AS VARCHAR) END) * 100 ELSE 0 END AS rpc_rate, SUM(CASE WHEN ce.contact_rank = 1 AND ce.is_rpc = 1 THEN ce.payment_within_7days ELSE 0 END) AS rpcs_with_payment, CASE WHEN SUM(CASE WHEN ce.contact_rank = 1 THEN ce.is_rpc ELSE 0 END) > 0 THEN CAST(SUM(CASE WHEN ce.contact_rank = 1 AND ce.is_rpc = 1 THEN ce.payment_within_7days ELSE 0 END) AS FLOAT) / SUM(CASE WHEN ce.contact_rank = 1 THEN ce.is_rpc ELSE 0 END) * 100 ELSE 0 END AS rpc_to_payment_rate, SUM(CASE WHEN ce.contact_rank = 1 AND ce.is_rpc = 1 THEN ce.arrangement_within_7days ELSE 0 END) AS rpcs_with_arrangement, CASE WHEN SUM(CASE WHEN ce.contact_rank = 1 THEN ce.is_rpc ELSE 0 END) > 0 THEN CAST(SUM(CASE WHEN ce.contact_rank = 1 AND ce.is_rpc = 1 THEN ce.arrangement_within_7days ELSE 0 END) AS FLOAT) / SUM(CASE WHEN ce.contact_rank = 1 THEN ce.is_rpc ELSE 0 END) * 100 ELSE 0 END AS rpc_to_arrangement_rate FROM ContactEffectiveness ce INNER JOIN cntct cnt ON ce.cnsmr_id = cnt.cnsmr_id AND ce.cntct_dt = cnt.cntct_dt INNER JOIN emplye e ON cnt.emplye_id = e.emplye_id INNER JOIN wrkgrp w ON e.wrkgrp_id = w.wrkgrp_id INNER JOIN dprtmnt d ON w.wrkgrp_dprtmnt_id = d.dprtmnt_id WHERE ce.contact_rank = 1 AND cnt.cntct_dt >= DATEADD(month, -3, GETDATE()) GROUP BY e.emplye_id, e.emplye_frst_nm + ' ' + e.emplye_lst_nm, d.dprtmnt_shrt_nm, ce.cntct_typ_cd ORDER BY d.dprtmnt_shrt_nm, rpc_to_payment_rate DESC;"
}